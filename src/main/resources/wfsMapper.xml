<?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="wfsMapper">

	<resultMap id="wfsBaseMap" type="XMLMap">
		<result
	    	property="wfs:FeatureCollection"
	    	column="%ROOT_ELEMENT"
			javaType="string" />
	    <result
	    	property="xmlns:wfs=http://www.opengis.net/wfs"
	    	column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
	    <result
	    	property="xmlns:gml=http://www.opengis.net/gml"
	    	column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
		<result
	    	property="xmlns:sa=http://www.opengis.net/sampling/1.0"
	    	column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
	    <result
	    	property="xmlns:gwml=http://www.nrcan.gc.ca/xml/gwml/1"
	    	column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
		<result
	    	property="xmlns:gsml=urn:cgi:xmlns:CGI:GeoSciML:2.0"
	    	column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
		<result
    		property="xmlns:xlink=http://www.w3.org/1999/xlink"
    		column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
		<result
    		property="xmlns:xs=http://www.w3.org/2001/XMLSchema"
    		column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
		<result
    		property="xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance"
    		column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
		<result
    		property="xsi:schemaLocation=http://www.opengis.net/om/1.0 http://schemas.opengis.net/om/1.0.0/om.xsd"
    		column="%ROOT_ELEMENT_ATTRIBUTE"
			javaType="string" />
			
	</resultMap>
	
	<resultMap type="XMLMap" id="wfsResultMap" extends="wfsBaseMap">
	 	<result
	 		property="^!{gml:featureMember"
	 		column="id"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell#gml:id"
			column="id"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/^gml:name#codeSpace=urn:gov.usgs.nwis.station_nm"
			column="station_nm"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gml:name"
			column="station_nm"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/^gml:name#codeSpace=urn:gov.usgs.nwis.agency_cd_site_no"
			column="id"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gml:name"
			column="id"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gml:boundedBy/gml:envelope#srsName=EPSG:4326"
			column="long_lat"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gml:boundedBy/gml:envelope/gml:pos#srsDimension=2"
			column="long_lat"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gml:boundedBy/gml:envelope/gml:pos"
			column="long_lat"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/sa:position/gml:Point#srsName=EPSG:4326"
			column="long_lat_alt"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/sa:position/gml:Point/gml:pos"
			column="long_lat_alt"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gwml:referenceElevation#uom=urn:ogc:def:uom:UCUM:ft_i"
			column="alt"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gwml:referenceElevation"
			column="alt"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/^gwml:wellStatus/gsml:CGI_TermValue/gsml:value#codeSpace=urn:gov.usgs.nwis.alt_datum_cd"
			column="alt_datum_cd"
			javaType="string" />
		<result
			property="}gml:featureMember/gwml:WaterWell/gwml:wellStatus/gsml:CGI_TermValue/gsml:value"
			column="alt_datum_cd"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/^gwml:wellDepth/gsml:CGI_NumericValue/gsml:principalValue#uom=urn:ogc:def:uom:UCUM:ft"
			column="well_depth_va"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gwml:wellDepth/gsml:CGI_NumericValue/gsml:principalValue"
			column="well_depth_va"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/^gwml:wellType/gsml:CGI_TermValue/gsml:value#codeSpace=urn:gov.usgs.nwis.nat_water_use_cd"
			column="nat_water_use_name"
			javaType="string" />
		<result
			property="gml:featureMember/gwml:WaterWell/gwml:wellType/gsml:CGI_TermValue/gsml:value"
			column="nat_water_use_name"
			javaType="string" />
	</resultMap>
	
	<select id="wfsSelect" parameterType="map" resultMap="wfsResultMap" fetchSize="1024" useCache="false">
		SELECT DISTINCT
			s.agency_cd||'.'||s.site_no AS id,
			s.station_nm,
			s.dec_long_va||' '||s.dec_lat_va AS long_lat,
			s.dec_long_va||' '||s.dec_lat_va||' '||s.alt_va AS long_lat_alt,
			s.alt_va AS alt,
			s.alt_datum_cd,
			s.well_depth_va,
			s.nat_water_use_name
		FROM
			nwis_dwh_star.sites_gw_mvw_summ s
		WHERE  
		    s.dec_lat_va BETWEEN #{south[0]} AND #{north[0]}
		AND
		 	s.dec_long_va BETWEEN #{west[0]} AND #{east[0]}
		<if test="maxFeatures != null">
		AND ROWNUM<![CDATA[ < ]]> #maxFeatures[0]
		</if>
	    ORDER BY
			s.station_nm
	</select>

</mapper> 
